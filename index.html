<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Smart Home Control</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<script src="https://unpkg.com/mqtt/dist/mqtt.min.js"></script>

<style>
:root{
  --glass: rgba(255,255,255,0.15);
  --blur: blur(25px);
  --on: #22c55e;
  --off: #64748b;
  --accent: #38bdf8;
  --radius: 22px;
}

*{box-sizing:border-box}

body{
  margin:0;
  font-family: "Segoe UI", system-ui;
  background:
    radial-gradient(circle at top, #1e293b, #020617);
  color:#fff;
  min-height:100vh;
}

/* ===== LOGIN ===== */
.login{
  position:fixed;
  inset:0;
  display:flex;
  align-items:center;
  justify-content:center;
  background:radial-gradient(circle at top, #020617, #000);
  z-index:1000;
}

.login-box{
  width:360px;
  padding:32px;
  border-radius:28px;
  background:var(--glass);
  backdrop-filter:var(--blur);
  box-shadow:0 30px 70px rgba(0,0,0,.6);
  text-align:center;
}

.login-box h2{
  margin:0;
  font-size:26px;
  letter-spacing:1px;
}

.login-box p{
  opacity:.7;
  margin-bottom:20px;
}

.login-box input{
  width:100%;
  padding:14px 18px;
  margin:12px 0;
  border-radius:30px;
  border:none;
  outline:none;
  background:rgba(255,255,255,.18);
  color:white;
  font-size:15px;
}

.login-box button{
  width:100%;
  padding:14px;
  margin-top:10px;
  border-radius:30px;
  border:none;
  background:linear-gradient(90deg,#22c55e,#4ade80);
  font-weight:700;
  font-size:16px;
  cursor:pointer;
}

.error{
  color:#f87171;
  margin-top:10px;
  display:none;
}

/* ===== DASHBOARD ===== */
.dashboard{
  max-width:1200px;
  margin:auto;
  padding:20px;
  display:none;
  grid-template-columns:2fr 1fr;
  gap:20px;
}

.glass{
  background:var(--glass);
  backdrop-filter:var(--blur);
  border-radius:var(--radius);
  box-shadow:0 20px 50px rgba(0,0,0,.45);
}

/* HEADER */
.header{
  grid-column:1/3;
  display:flex;
  justify-content:space-between;
  align-items:center;
  padding:20px 26px;
}

.header strong{
  font-size:22px;
}

.header small{
  opacity:.7;
}

.logout{
  cursor:pointer;
  font-size:13px;
  opacity:.7;
}

/* DEVICE GRID */
.devices{
  padding:22px;
}

.device{
  padding:18px 20px;
  border-radius:18px;
  background:rgba(255,255,255,0.1);
  display:flex;
  justify-content:space-between;
  align-items:center;
  margin-bottom:14px;
  transition:.3s;
}

.device:hover{
  background:rgba(255,255,255,0.18);
  transform:translateY(-2px);
}

.device span{
  font-size:16px;
}

/* SWITCH */
.switch{
  width:56px;
  height:30px;
  position:relative;
}
.switch input{display:none}

.slider{
  position:absolute;
  inset:0;
  background:var(--off);
  border-radius:30px;
  transition:.3s;
}
.slider:before{
  content:"";
  position:absolute;
  width:24px;
  height:24px;
  top:3px;
  left:3px;
  background:white;
  border-radius:50%;
  transition:.3s;
}

input:checked + .slider{
  background:linear-gradient(90deg,#22c55e,#4ade80);
}
input:checked + .slider:before{
  transform:translateX(26px);
}

/* INFO PANEL */
.info{
  padding:22px;
  text-align:center;
}

.info h1{
  font-size:46px;
  margin:10px 0;
  color:var(--accent);
}

.info small{
  opacity:.7;
}

/* RESPONSIVE */
@media(max-width:900px){
  .dashboard{
    grid-template-columns:1fr;
  }
}
</style>
</head>

<body>

<!-- LOGIN -->
<div class="login" id="loginBox">
  <div class="login-box">
    <h2>Smart Home</h2>
    <p>Secure Access</p>

    <input id="user" placeholder="Username">
    <input id="pass" type="password" placeholder="PIN / Password">

    <button onclick="login()">Login</button>
    <div class="error" id="err">Invalid credentials</div>
  </div>
</div>

<!-- DASHBOARD -->
<div class="dashboard" id="dash">

  <div class="glass header">
    <div>
      <strong>Smart Home</strong><br>
      <small id="time"></small>
    </div>
    <div style="text-align:right">
      <div id="connStatus">ðŸ”´ Offline</div>
      <div class="logout" onclick="logout()">Logout</div>
    </div>
  </div>

  <div class="glass devices">
    <div class="device"><span>Living Room</span>
      <label class="switch"><input type="checkbox" id="r0"><span class="slider"></span></label>
    </div>
    <div class="device"><span>Kitchen</span>
      <label class="switch"><input type="checkbox" id="r1"><span class="slider"></span></label>
    </div>
    <div class="device"><span>Bedroom</span>
      <label class="switch"><input type="checkbox" id="r2"><span class="slider"></span></label>
    </div>
    <div class="device"><span>Dining</span>
      <label class="switch"><input type="checkbox" id="r3"><span class="slider"></span></label>
    </div>
  </div>

  <div class="glass info">
    <small>Room Temperature</small>
    <h1><span id="temp">--</span>Â°C</h1>
    <small>Live from ESP</small>
  </div>

</div>

<script>
/* ===== LOGIN ===== */
const USERNAME="admin";
const PASSWORD="1234";

function login(){
  if(user.value===USERNAME && pass.value===PASSWORD){
    localStorage.setItem("auth","1");
    loginBox.style.display="none";
    dash.style.display="grid";
  }else err.style.display="block";
}

function logout(){
  localStorage.removeItem("auth");
  location.reload();
}

if(localStorage.getItem("auth")==="1"){
  loginBox.style.display="none";
  dash.style.display="grid";
}

/* ===== CLOCK ===== */
setInterval(()=>time.innerText=new Date().toLocaleString(),1000);

/* ===== MQTT ===== */
const client=mqtt.connect("wss://broker.emqx.io:8084/mqtt");
const statusEl=document.getElementById("connStatus");

client.on("connect",()=>{
  statusEl.innerText="ðŸŸ¢ Online";
  client.subscribe("home/rudra/relay/+/state");
  client.subscribe("home/rudra/temperature");
});

client.on("offline",()=>statusEl.innerText="ðŸ”´ Offline");

client.on("message",(t,m)=>{
  if(t.includes("relay")){
    const i=t.match(/relay\/(\d+)/)[1];
    document.getElementById("r"+i).checked=(m=="ON");
  }
  if(t==="home/rudra/temperature"){
    temp.innerText=m;
  }
});

function send(i,v){
  client.publish(`home/rudra/relay/${i}/set`,v?"ON":"OFF");
}

for(let i=0;i<4;i++){
  document.getElementById("r"+i).onchange=e=>send(i,e.target.checked);
}
</script>

</body>
</html>
